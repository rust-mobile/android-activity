#!/usr/bin/env bash

# Copies files from android-games-sdk-rs so that we don't have to use
# it has a submodule (see https://github.com/rust-mobile/android-activity/issues/190)

# Usage: ./copy_files source_dir dest_dir file_list.txt
# file_list.txt should contain one filename or path pattern per line

# Check if correct number of arguments
if [ $# -ne 1 ]; then
    echo "Usage: $0 <android-games-sdk-rs dir>"
    exit 1
fi

SOURCE_DIR="$1"
DEST_DIR="${2:-.}"
FILE_LIST="${3:-file_list.txt}"

# Check if source directory exists
if [ ! -d "$SOURCE_DIR" ]; then
    echo "Error: Source directory '$SOURCE_DIR' does not exist."
    exit 1
fi

# Check if file list exists
if [ ! -f "$FILE_LIST" ]; then
    echo "Error: File list '$FILE_LIST' does not exist."
    exit 1
fi

# Create destination directory if it doesn't exist
mkdir -p "$DEST_DIR"

# Read file list and copy each file
while IFS= read -r file || [ -n "$file" ]; do
    # Skip empty lines and comments
    if [ -z "$file" ] || [[ "$file" =~ ^# ]]; then
	continue
    fi

    # Find matching files
    find "$SOURCE_DIR" -name "$file" -type f | while read -r file; do
	# Get the relative path
	rel_path="${file#$SOURCE_DIR/}"
	dest_file="$DEST_DIR/$rel_path"
	dest_dir=$(dirname "$dest_file")

	# Create destination directory structure
	mkdir -p "$dest_dir"

	# Copy the file
	cp "$file" "$dest_file"
	echo "Copied: $rel_path"
    done
done < "$FILE_LIST"

echo "Copy operation completed."
